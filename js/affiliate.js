(()=>{var e,t,r=Object.defineProperty,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(e,t,i)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,s=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&a(e,r,t[r]);if(i)for(var r of i(t))n.call(t,r)&&a(e,r,t[r]);return e},l=(e,t,r)=>new Promise(((i,o)=>{var n=e=>{try{s(r.next(e))}catch(e){o(e)}},a=e=>{try{s(r.throw(e))}catch(e){o(e)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,a);s((r=r.apply(e,t)).next())})),f=window||f,c=(null==(e=f.lemonSqueezyAffiliateConfig)?void 0:e.baseUrl)||"https://app.lemonsqueezy.com",u=!1!==(null==(t=f.lemonSqueezyAffiliateConfig)?void 0:t.trackOnLoad),h=function(){return{Track:function(e=null){return l(this,null,(function*(){var t,r;let i=function(e){for(var t=e+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(var o=r[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}("ls_aff_ref");if(e||(e=new URLSearchParams(window.location.search).get("aff")),!e&&!i)return;if(!f.lemonSqueezyAffiliateConfig)return void console.warn("lemonSqueezyAffiliateConfig not found. Skipping setup...");if(!f.lemonSqueezyAffiliateConfig.store)return void console.error("lemonSqueezyAffiliateConfig.store is required");let o={store:f.lemonSqueezyAffiliateConfig.store,url:window.location.href,referrer:document.referrer};e?o.affiliate_ref=e:o.click_ref=i;let n=yield function(e,t){return l(this,null,(function*(){return yield fetch(e,{method:"POST",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})}))}(`${c}/affiliates/track`,o);if(n.ok){let e=yield n.json();(function(e){let t=[new URL(c).hostname.replace("app.",""),...f.lemonSqueezyAffiliateConfig.domains||[]];new d({hosts:t,clickId:e}).attach()})(e.click),function(e,t,r){document.cookie=e+"="+t+"; expires="+r+"; path=/"}("ls_aff_ref",e.click,e.expires),null==(r=null==(t=f.lemonSqueezyAffiliateConfig)?void 0:t.onTrack)||r.call(t,s(s({},o),e))}else console.error("Failed to track affiliate click",yield n.json())}))}}};f.createLemonSqueezyAffiliate=function(){var e,t;f.LemonSqueezyAffiliate||(f.LemonSqueezyAffiliate=new h),null==(t=null==(e=f.lemonSqueezyAffiliateConfig)?void 0:e.onReady)||t.call(e,f.LemonSqueezyAffiliate),u&&f.LemonSqueezyAffiliate.Track()},f.addEventListener?f.addEventListener("load",f.createLemonSqueezyAffiliate):f.attachEvent&&f.attachEvent("onload",window.createLemonSqueezyAffiliate);var d=class{constructor(e){this.state={attached:!1,hosts:e.hosts||[],clickId:e.clickId||null},this.observer=void 0,this.hasMutationObserver()&&(this.observer=new window.MutationObserver((e=>{e.forEach((e=>{if("attributes"===e.type){if("href"!==e.attributeName)return;let t=e.target.href,r=this.getNodeData(e.target);if(r.is&&r.is===t)return}this.traverse(e.target)}))})))}traverse(e=document.body){if("object"!=typeof e||"function"!=typeof e.getElementsByTagName)return this;if(!this.hasURL())return console.error("This browser needs a URL polyfill."),this;let t=e.getElementsByTagName("a"),r=Object.values(t);return"a"===e.nodeName.toLowerCase()&&(r=[e]),r.forEach((e=>{if(!e||!("href"in e))return;let t=new URL(e.href||"",window.location.origin);this.state.hosts.forEach((r=>{t.host.includes(r)&&this.modifyURL(t,e)}))})),this}modifyURL(e,t){let r=this.getNodeData(t);if(r.is&&r.is===e.href)return;let i=e.href,o=this.convert(e);t.href=o,this.setNodeData(t,{was:i,is:e.href})}convert(e){if("object"==typeof e&&(e=e.href),!this.hasURL())return console.error("This browser needs a URL polyfill."),e;let t=new URL(e,window.location.origin);return t.searchParams.set("aff_ref",this.state.clickId),t.href}attach(){if(this.state.attached||"undefined"==typeof document)return this;let{readyState:e}=document;return"complete"===e||"interactive"===e?(this.state.attached=!0,this.traverse(),this.hasMutationObserver()&&this.observer?this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0,attributeFilter:["href"]}):console.warn("Browser does not support MutationObserver.")):window.addEventListener("DOMContentLoaded",this.attach),this}detach(){return this.hasMutationObserver()&&this.observer?(this.state.attached=!1,this.observer.disconnect(),this):this}hasMutationObserver(){return"object"==typeof window&&void 0!==window.MutationObserver}hasURL(){return"function"==typeof URL&&"function"==typeof URLSearchParams}getNodeData(e){return e._aff||{}}setNodeData(e,t){Object.assign(e,{_aff:t})}}})();